<div class="row" *ngIf="cartItems.length > 0; else emptyCart">
  <div class="col-lg-8">
    <div class="card mb-4">
      <div class="card-header bg-white">
        <h3 class="mb-0">Shipping Information</h3>
      </div>
      
      <div class="card-body">
        <form [formGroup]="checkoutForm" (ngSubmit)="placeOrder()" novalidate>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="firstName" class="form-label">First Name</label>
              <input type="text" 
                     class="form-control" 
                     id="firstName" 
                     formControlName="firstName"
                     [ngClass]="{ 'is-invalid': checkoutForm.get('firstName')?.invalid && checkoutForm.get('firstName')?.touched }">
              <div class="invalid-feedback" *ngIf="checkoutForm.get('firstName')?.errors?.['required']">
                First name is required
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label for="lastName" class="form-label">Last Name</label>
              <input type="text" 
                     class="form-control" 
                     id="lastName" 
                     formControlName="lastName"
                     [ngClass]="{ 'is-invalid': checkoutForm.get('lastName')?.invalid && checkoutForm.get('lastName')?.touched }">
              <div class="invalid-feedback" *ngIf="checkoutForm.get('lastName')?.errors?.['required']">
                Last name is required
              </div>
            </div>
          </div>
          
          <div class="mb-3">
            <label for="address" class="form-label">Address</label>
            <input type="text" 
                   class="form-control" 
                   id="address" 
                   formControlName="address"
                   [ngClass]="{ 'is-invalid': checkoutForm.get('address')?.invalid && checkoutForm.get('address')?.touched }">
            <div class="invalid-feedback" *ngIf="checkoutForm.get('address')?.errors?.['required']">
              Address is required
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="city" class="form-label">City</label>
              <input type="text" 
                     class="form-control" 
                     id="city" 
                     formControlName="city"
                     [ngClass]="{ 'is-invalid': checkoutForm.get('city')?.invalid && checkoutForm.get('city')?.touched }">
              <div class="invalid-feedback" *ngIf="checkoutForm.get('city')?.errors?.['required']">
                City is required
              </div>
            </div>
            
            <div class="col-md-4 mb-3">
              <label for="state" class="form-label">State</label>
              <input type="text" 
                     class="form-control" 
                     id="state" 
                     formControlName="state"
                     [ngClass]="{ 'is-invalid': checkoutForm.get('state')?.invalid && checkoutForm.get('state')?.touched }">
              <div class="invalid-feedback" *ngIf="checkoutForm.get('state')?.errors?.['required']">
                State is required
              </div>
            </div>
            
            <div class="col-md-2 mb-3">
              <label for="zipCode" class="form-label">Zip</label>
              <input type="text" 
                     class="form-control" 
                     id="zipCode" 
                     formControlName="zipCode"
                     [ngClass]="{ 'is-invalid': checkoutForm.get('zipCode')?.invalid && checkoutForm.get('zipCode')?.touched }">
              <div class="invalid-feedback" *ngIf="checkoutForm.get('zipCode')?.errors?.['required']">
                Zip code is required
              </div>
            </div>
          </div>
          
          <div class="mb-3">
            <label for="phone" class="form-label">Phone Number</label>
            <input type="tel" 
                   class="form-control" 
                   id="phone" 
                   formControlName="phone"
                   [ngClass]="{ 'is-invalid': checkoutForm.get('phone')?.invalid && checkoutForm.get('phone')?.touched }">
            <div class="invalid-feedback" *ngIf="checkoutForm.get('phone')?.errors?.['required']">
              Phone number is required
            </div>
          </div>
          
          <hr class="my-4">
          
          <h4 class="mb-3">Payment</h4>
          
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="cc-name" class="form-label">Name on card</label>
              <input type="text" 
                     class="form-control" 
                     id="cc-name" 
                     formControlName="cardName"
                     [ngClass]="{ 'is-invalid': checkoutForm.get('cardName')?.invalid && checkoutForm.get('cardName')?.touched }">
              <div class="invalid-feedback" *ngIf="checkoutForm.get('cardName')?.errors?.['required']">
                Name on card is required
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label for="cc-number" class="form-label">Credit card number</label>
              <input type="text" 
                     class="form-control" 
                     id="cc-number" 
                     formControlName="cardNumber"
                     [ngClass]="{ 'is-invalid': checkoutForm.get('cardNumber')?.invalid && checkoutForm.get('cardNumber')?.touched }">
              <div class="invalid-feedback" *ngIf="checkoutForm.get('cardNumber')?.errors?.['required']">
                Credit card number is required
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-3 mb-3">
              <label for="cc-expiration" class="form-label">Expiration</label>
              <input type="text" 
                     class="form-control" 
                     id="cc-expiration" 
                     placeholder="MM/YY"
                     formControlName="cardExpiry"
                     [ngClass]="{ 'is-invalid': checkoutForm.get('cardExpiry')?.invalid && checkoutForm.get('cardExpiry')?.touched }">
              <div class="invalid-feedback" *ngIf="checkoutForm.get('cardExpiry')?.errors?.['required']">
                Expiration date is required
              </div>
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="cc-cvv" class="form-label">CVV</label>
              <input type="text" 
                     class="form-control" 
                     id="cc-cvv" 
                     formControlName="cardCvv"
                     [ngClass]="{ 'is-invalid': checkoutForm.get('cardCvv')?.invalid && checkoutForm.get('cardCvv')?.touched }">
              <div class="invalid-feedback" *ngIf="checkoutForm.get('cardCvv')?.errors?.['required']">
                Security code is required
              </div>
            </div>
          </div>
          
          <hr class="my-4">
          
          <button class="btn btn-dark btn-lg w-100" 
                  type="submit"
                  [disabled]="checkoutForm.invalid || isLoading">
            <span *ngIf="!isLoading">Place Order</span>
            <span *ngIf="isLoading">
              <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
              Processing...
            </span>
          </button>
        </form>
      </div>
    </div>
  </div>
  
  <div class="col-lg-4">
    <div class="card mb-4">
      <div class="card-header bg-white">
        <h3 class="mb-0">Order Summary</h3>
      </div>
      
      <div class="card-body">
        <ul class="list-group list-group-flush">
          <li class="list-group-item d-flex justify-content-between align-items-center"
              *ngFor="let item of cartItems">
            <div>
              <h6 class="my-0">{{ item.name }}</h6>
              <small class="text-muted">Qty: {{ item.quantity }}</small>
            </div>
            <span class="text-muted">{{ item.price * item.quantity | currency }}</span>
          </li>
          
          <li class="list-group-item d-flex justify-content-between">
            <span>Subtotal</span>
            <strong>{{ total | currency }}</strong>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Shipping</span>
            <strong>Free</strong>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Tax</span>
            <strong>{{ tax | currency }}</strong>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Total</span>
            <strong>{{ total + tax | currency }}</strong>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<ng-template #emptyCart>
  <div class="text-center py-5">
    <i class="fas fa-shopping-cart fa-4x text-muted mb-3"></i>
    <h3>Your cart is empty</h3>
    <p>There are no items in your cart to checkout</p>
    <a routerLink="/products" class="btn btn-primary">Continue Shopping</a>
  </div>
</ng-template>